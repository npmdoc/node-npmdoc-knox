<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/LearnBoost/knox"

    >knox (v0.9.2)</a>
</h1>
<h4>Amazon S3 client</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox">module knox</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.knox">
            function <span class="apidocSignatureSpan"></span>knox
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client">
            function <span class="apidocSignatureSpan">knox.</span>client
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.createClient">
            function <span class="apidocSignatureSpan">knox.</span>createClient
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.</span>client.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.</span>utils</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.</span>utils.base64</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox.auth">module knox.auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.authorization">
            function <span class="apidocSignatureSpan">knox.auth.</span>authorization
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.canonicalizeHeaders">
            function <span class="apidocSignatureSpan">knox.auth.</span>canonicalizeHeaders
            <span class="apidocSignatureSpan">(headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.canonicalizeResource">
            function <span class="apidocSignatureSpan">knox.auth.</span>canonicalizeResource
            <span class="apidocSignatureSpan">(resource)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.hmacSha1">
            function <span class="apidocSignatureSpan">knox.auth.</span>hmacSha1
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.queryStringToSign">
            function <span class="apidocSignatureSpan">knox.auth.</span>queryStringToSign
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.sign">
            function <span class="apidocSignatureSpan">knox.auth.</span>sign
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.signQuery">
            function <span class="apidocSignatureSpan">knox.auth.</span>signQuery
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.auth.stringToSign">
            function <span class="apidocSignatureSpan">knox.auth.</span>stringToSign
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox.client">module knox.client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.client">
            function <span class="apidocSignatureSpan">knox.</span>client
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.createClient">
            function <span class="apidocSignatureSpan">knox.client.</span>createClient
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.client.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.client.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox.client.prototype">module knox.client.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.copy">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>copy
            <span class="apidocSignatureSpan">(sourceFilename, destFilename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.copyFile">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyFile
            <span class="apidocSignatureSpan">(sourceFilename, destFilename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.copyFileTo">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyFileTo
            <span class="apidocSignatureSpan">(sourceFilename, destBucket, destFilename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.copyTo">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyTo
            <span class="apidocSignatureSpan">(sourceFilename, destBucket, destFilename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.del">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>del
            <span class="apidocSignatureSpan">(filename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.deleteFile">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>deleteFile
            <span class="apidocSignatureSpan">(filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.deleteMultiple">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>deleteMultiple
            <span class="apidocSignatureSpan">(filenames, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.get">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>get
            <span class="apidocSignatureSpan">(filename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.getFile">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>getFile
            <span class="apidocSignatureSpan">(filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.head">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>head
            <span class="apidocSignatureSpan">(filename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.headFile">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>headFile
            <span class="apidocSignatureSpan">(filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.http">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>http
            <span class="apidocSignatureSpan">(filename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.https">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>https
            <span class="apidocSignatureSpan">(filename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.list">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>list
            <span class="apidocSignatureSpan">(params, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.put">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>put
            <span class="apidocSignatureSpan">(filename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.putBuffer">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>putBuffer
            <span class="apidocSignatureSpan">(buffer, filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.putFile">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>putFile
            <span class="apidocSignatureSpan">(src, filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.putStream">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>putStream
            <span class="apidocSignatureSpan">(stream, filename, headers, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.request">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>request
            <span class="apidocSignatureSpan">(method, filename, headers)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.client.prototype.signedUrl">
            function <span class="apidocSignatureSpan">knox.client.prototype.</span>signedUrl
            <span class="apidocSignatureSpan">(filename, expiration, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox.utils">module knox.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.utils.merge">
            function <span class="apidocSignatureSpan">knox.utils.</span>merge
            <span class="apidocSignatureSpan">(a, b)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">knox.utils.</span>base64</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.knox.utils.base64">module knox.utils.base64</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.utils.base64.decode">
            function <span class="apidocSignatureSpan">knox.utils.base64.</span>decode
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.knox.utils.base64.encode">
            function <span class="apidocSignatureSpan">knox.utils.base64.</span>encode
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox" id="apidoc.module.knox">module knox</a></h1>


    <h2>
        <a href="#apidoc.element.knox.knox" id="apidoc.element.knox.knox">
        function <span class="apidocSignatureSpan"></span>knox
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Client(options) {
  if (!options.key) throw new Error(&#x27;aws &#x22;key&#x22; required&#x27;);
  if (!options.secret) throw new Error(&#x27;aws &#x22;secret&#x22; required&#x27;);
  if (!options.bucket) throw new Error(&#x27;aws &#x22;bucket&#x22; required&#x27;);

  if (options.style &#x26;&#x26; options.style !== &#x27;virtualHosted&#x27; &#x26;&#x26;
      options.style !== &#x27;path&#x27;) {
    throw new Error(&#x27;style must be &#x22;virtualHosted&#x22; or &#x22;path&#x22;&#x27;);
  }

  if (options.port !== undefined &#x26;&#x26; isNaN(parseInt(options.port))) {
    throw new Error(&#x27;port must be a number.&#x27;);
  }

  var invalidness = isInvalid(options.bucket);
  var dnsUncompliance = isNotDnsCompliant(options.bucket);

  if (invalidness) {
    throw new Error(&#x27;Bucket name &#x22;&#x27; + options.bucket + &#x27;&#x22; &#x27; + invalidness + &#x27;.&#x27;);
  }

  // Save original options, we will need them for Client#copyTo
  this.options = utils.merge({}, options);

  // Make sure we don&#x27;t override options the user passes in.
  options = utils.merge({}, options);
  autoDetermineStyle(options);

  if (!options.endpoint) {
    if (!options.region || options.region === &#x27;us-standard&#x27; || options.region === &#x27;us-east-1&#x27;) {
      options.endpoint = &#x27;s3.amazonaws.com&#x27;;
      options.region = &#x27;us-standard&#x27;;
    } else {
      options.endpoint = &#x27;s3-&#x27; + options.region + &#x27;.amazonaws.com&#x27;;
    }

    if (options.region !== &#x27;us-standard&#x27;) {
      if (dnsUncompliance) {
        throw new Error(&#x27;Outside of the us-standard region, bucket names must&#x27; +
                        &#x27; be DNS-compliant. The name &#x22;&#x27; + options.bucket +
                        &#x27;&#x22; &#x27; + dnsUncompliance + &#x27;.&#x27;);
      }
    }
  } else {
    options.region = undefined;
  }

  var portSuffix = &#x27;undefined&#x27; == typeof options.port ? &#x22;&#x22; : &#x22;:&#x22; + options.port;
  this.secure = &#x27;undefined&#x27; == typeof options.port;

  if (options.style === &#x27;virtualHosted&#x27;) {
    this.host = options.bucket + &#x27;.&#x27; + options.endpoint;
    this.urlBase = options.bucket + &#x27;.&#x27; + options.endpoint + portSuffix;
  } else {
    this.host = options.endpoint;
    this.urlBase = options.endpoint + portSuffix + &#x27;/&#x27; + options.bucket;
  }

  // HTTP in Node.js &#x3c; 0.12 is horribly broken, and leads to lots of &#x22;socket
  // hang up&#x22; errors: https://github.com/LearnBoost/knox/issues/116. See
  // https://github.com/LearnBoost/knox/issues/116#issuecomment-15045187 and
  // https://github.com/substack/hyperquest#rant
  this.agent = false;

  utils.merge(this, options);

  this.url = this.secure ? this.https : this.http;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client" id="apidoc.element.knox.client">
        function <span class="apidocSignatureSpan">knox.</span>client
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Client(options) {
  if (!options.key) throw new Error(&#x27;aws &#x22;key&#x22; required&#x27;);
  if (!options.secret) throw new Error(&#x27;aws &#x22;secret&#x22; required&#x27;);
  if (!options.bucket) throw new Error(&#x27;aws &#x22;bucket&#x22; required&#x27;);

  if (options.style &#x26;&#x26; options.style !== &#x27;virtualHosted&#x27; &#x26;&#x26;
      options.style !== &#x27;path&#x27;) {
    throw new Error(&#x27;style must be &#x22;virtualHosted&#x22; or &#x22;path&#x22;&#x27;);
  }

  if (options.port !== undefined &#x26;&#x26; isNaN(parseInt(options.port))) {
    throw new Error(&#x27;port must be a number.&#x27;);
  }

  var invalidness = isInvalid(options.bucket);
  var dnsUncompliance = isNotDnsCompliant(options.bucket);

  if (invalidness) {
    throw new Error(&#x27;Bucket name &#x22;&#x27; + options.bucket + &#x27;&#x22; &#x27; + invalidness + &#x27;.&#x27;);
  }

  // Save original options, we will need them for Client#copyTo
  this.options = utils.merge({}, options);

  // Make sure we don&#x27;t override options the user passes in.
  options = utils.merge({}, options);
  autoDetermineStyle(options);

  if (!options.endpoint) {
    if (!options.region || options.region === &#x27;us-standard&#x27; || options.region === &#x27;us-east-1&#x27;) {
      options.endpoint = &#x27;s3.amazonaws.com&#x27;;
      options.region = &#x27;us-standard&#x27;;
    } else {
      options.endpoint = &#x27;s3-&#x27; + options.region + &#x27;.amazonaws.com&#x27;;
    }

    if (options.region !== &#x27;us-standard&#x27;) {
      if (dnsUncompliance) {
        throw new Error(&#x27;Outside of the us-standard region, bucket names must&#x27; +
                        &#x27; be DNS-compliant. The name &#x22;&#x27; + options.bucket +
                        &#x27;&#x22; &#x27; + dnsUncompliance + &#x27;.&#x27;);
      }
    }
  } else {
    options.region = undefined;
  }

  var portSuffix = &#x27;undefined&#x27; == typeof options.port ? &#x22;&#x22; : &#x22;:&#x22; + options.port;
  this.secure = &#x27;undefined&#x27; == typeof options.port;

  if (options.style === &#x27;virtualHosted&#x27;) {
    this.host = options.bucket + &#x27;.&#x27; + options.endpoint;
    this.urlBase = options.bucket + &#x27;.&#x27; + options.endpoint + portSuffix;
  } else {
    this.host = options.endpoint;
    this.urlBase = options.endpoint + portSuffix + &#x27;/&#x27; + options.bucket;
  }

  // HTTP in Node.js &#x3c; 0.12 is horribly broken, and leads to lots of &#x22;socket
  // hang up&#x22; errors: https://github.com/LearnBoost/knox/issues/116. See
  // https://github.com/LearnBoost/knox/issues/116#issuecomment-15045187 and
  // https://github.com/substack/hyperquest#rant
  this.agent = false;

  utils.merge(this, options);

  this.url = this.secure ? this.https : this.http;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.createClient" id="apidoc.element.knox.createClient">
        function <span class="apidocSignatureSpan">knox.</span>createClient
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createClient = function (options){
  return new Client(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

## Examples

The following examples demonstrate some capabilities of knox and the S3 REST
API. First things first, create an S3 client:

```js
var client = knox.<span class="apidocCodeKeywordSpan">createClient</span>({
    key: &#x27;&#x3c;api-key-here&#x3e;&#x27;
  , secret: &#x27;&#x3c;secret-here&#x3e;&#x27;
  , bucket: &#x27;learnboost&#x27;
});
```

More options are documented below for features like other endpoints or regions.
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox.auth" id="apidoc.module.knox.auth">module knox.auth</a></h1>


    <h2>
        <a href="#apidoc.element.knox.auth.authorization" id="apidoc.element.knox.auth.authorization">
        function <span class="apidocSignatureSpan">knox.auth.</span>authorization
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authorization = function (options){
  return &#x27;AWS &#x27; + options.key + &#x27;:&#x27; + exports.sign(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  headers.Host = this.host;
}

if (&#x27;undefined&#x27; != typeof this.token)
  headers[&#x27;x-amz-security-token&#x27;] = this.token;

// Authorization header
headers.Authorization = auth.<span class="apidocCodeKeywordSpan">authorization</span>({
    key: this.key
  , secret: this.secret
  , verb: method
  , date: date
  , resource: auth.canonicalizeResource(&#x27;/&#x27; + this.bucket + fixedFilename)
  , contentType: getHeader(headers, &#x27;content-type&#x27;)
  , md5: getHeader(headers, &#x27;content-md5&#x27;) || &#x27;&#x27;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.canonicalizeHeaders" id="apidoc.element.knox.auth.canonicalizeHeaders">
        function <span class="apidocSignatureSpan">knox.auth.</span>canonicalizeHeaders
        <span class="apidocSignatureSpan">(headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">canonicalizeHeaders = function (headers){
  var buf = []
    , fields = Object.keys(headers);
  for (var i = 0, len = fields.length; i &#x3c; len; ++i) {
    var field = fields[i]
      , val = headers[field];

    field = field.toLowerCase();

    if (field.indexOf(&#x27;x-amz&#x27;) !== 0 || field === &#x27;x-amz-date&#x27;) {
      continue;
    }

    buf.push(field + &#x27;:&#x27; + val);
  }

  var headerSort = function(a, b) {
    // Headers are sorted lexigraphically based on the header name only.
    a = a.split(&#x22;:&#x22;)[0]
    b = b.split(&#x22;:&#x22;)[0]

    return a &#x3e; b ? 1 : -1;
  }
  return buf.sort(headerSort).join(&#x27;\n&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

exports.queryStringToSign = function(options){
 return (options.verb || &#x27;GET&#x27;) + &#x27;\n\n&#x27; +
   (typeof options.contentType !== &#x27;undefined&#x27; ?
     options.contentType : &#x27;&#x27;) + &#x27;\n&#x27; +
   options.date + &#x27;\n&#x27; +
   (typeof options.extraHeaders !== &#x27;undefined&#x27; ?
     exports.<span class="apidocCodeKeywordSpan">canonicalizeHeaders</span>(options.extraHeaders) + &#x27;\n&#x27; : &#x27;&#x27
;) +
   (typeof options.token !== &#x27;undefined&#x27; ?
     &#x27;x-amz-security-token:&#x27; + options.token + &#x27;\n&#x27; : &#x27;&#x27;) +
   options.resource;
};

/**
* Perform the following:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.canonicalizeResource" id="apidoc.element.knox.auth.canonicalizeResource">
        function <span class="apidocSignatureSpan">knox.auth.</span>canonicalizeResource
        <span class="apidocSignatureSpan">(resource)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">canonicalizeResource = function (resource){
  var url = parse(resource, true)
    , path = url.pathname
    , buf = [];

  // apply the query string whitelist
  Object.keys(url.query).forEach(function (key) {
      if (whitelist.indexOf(key) != -1) {
          buf.push(key + (url.query[key] ? &#x22;=&#x22; + url.query[key] : &#x27;&#x27;));
      }
  });

  return path + (buf.length
    ? &#x27;?&#x27; + buf.sort().join(&#x27;&#x26;&#x27;)
    : &#x27;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Authorization header
headers.Authorization = auth.authorization({
    key: this.key
  , secret: this.secret
  , verb: method
  , date: date
  , resource: auth.<span class="apidocCodeKeywordSpan">canonicalizeResource</span>(&#x27;/&#x27; + this.bucket + fixedFilename)
  , contentType: getHeader(headers, &#x27;content-type&#x27;)
  , md5: getHeader(headers, &#x27;content-md5&#x27;) || &#x27;&#x27;
  , amazonHeaders: auth.canonicalizeHeaders(headers)
});

var pathPrefix = this.style === &#x27;path&#x27; ? &#x27;/&#x27; + this.bucket : &#x27;&#x27;;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.hmacSha1" id="apidoc.element.knox.auth.hmacSha1">
        function <span class="apidocSignatureSpan">knox.auth.</span>hmacSha1
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hmacSha1 = function (options){
  return crypto.createHmac(&#x27;sha1&#x27;, options.secret).update(new Buffer(options.message, &#x27;utf-8&#x27;)).digest(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Object} options
* @return {String}
* @api private
*/

exports.sign = function(options){
 options.message = exports.stringToSign(options);
 return exports.<span class="apidocCodeKeywordSpan">hmacSha1</span>(options);
};

/**
* Create a base64 sha1 HMAC for `options`.
*
* Specifically to be used with S3 presigned URLs
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.queryStringToSign" id="apidoc.element.knox.auth.queryStringToSign">
        function <span class="apidocSignatureSpan">knox.auth.</span>queryStringToSign
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">queryStringToSign = function (options){
  return (options.verb || &#x27;GET&#x27;) + &#x27;\n\n&#x27; +
    (typeof options.contentType !== &#x27;undefined&#x27; ?
      options.contentType : &#x27;&#x27;) + &#x27;\n&#x27; +
    options.date + &#x27;\n&#x27; +
    (typeof options.extraHeaders !== &#x27;undefined&#x27; ?
      exports.canonicalizeHeaders(options.extraHeaders) + &#x27;\n&#x27; : &#x27;&#x27;) +
    (typeof options.token !== &#x27;undefined&#x27; ?
      &#x27;x-amz-security-token:&#x27; + options.token + &#x27;\n&#x27; : &#x27;&#x27;) +
    options.resource;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {Object} options
* @return {String}
* @api private
*/

exports.signQuery = function(options){
 options.message = exports.<span class="apidocCodeKeywordSpan">queryStringToSign</span>(options);
 return exports.hmacSha1(options);
};

/**
* Return a string for sign() with the given `options`.
*
* Spec:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.sign" id="apidoc.element.knox.auth.sign">
        function <span class="apidocSignatureSpan">knox.auth.</span>sign
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sign = function (options){
  options.message = exports.stringToSign(options);
  return exports.hmacSha1(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {Object} options
* @return {String}
* @api private
*/

exports.authorization = function(options){
 return &#x27;AWS &#x27; + options.key + &#x27;:&#x27; + exports.<span class="apidocCodeKeywordSpan">sign</span>(options);
};

/**
* Simple HMAC-SHA1 Wrapper
*
* @param {Object} options
* @return {String}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.signQuery" id="apidoc.element.knox.auth.signQuery">
        function <span class="apidocSignatureSpan">knox.auth.</span>signQuery
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">signQuery = function (options){
  options.message = exports.queryStringToSign(options);
  return exports.hmacSha1(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  , pathname = url.parse(filename).pathname
  , resource = &#x27;/&#x27; + this.bucket + ensureLeadingSlash(pathname);

if (options &#x26;&#x26; options.qs) {
  resource += &#x27;?&#x27; + decodeURIComponent(qs.stringify(options.qs));
}

var signature = auth.<span class="apidocCodeKeywordSpan">signQuery</span>({
    secret: this.secret
  , date: epoch
  , resource: resource
  , verb: (options &#x26;&#x26; options.verb) || &#x27;GET&#x27;
  , contentType: options &#x26;&#x26; options.contentType
  , extraHeaders : options &#x26;&#x26; options.extraHeaders
  , token: this.token
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.auth.stringToSign" id="apidoc.element.knox.auth.stringToSign">
        function <span class="apidocSignatureSpan">knox.auth.</span>stringToSign
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stringToSign = function (options){
  var headers = options.amazonHeaders || &#x27;&#x27;;
  if (headers) headers += &#x27;\n&#x27;;
  return [
      options.verb
    , options.md5
    , options.contentType
    , options.date instanceof Date ? options.date.toUTCString() : options.date
    , headers + options.resource
  ].join(&#x27;\n&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {Object} options
* @return {String}
* @api private
*/

exports.sign = function(options){
 options.message = exports.<span class="apidocCodeKeywordSpan">stringToSign</span>(options);
 return exports.hmacSha1(options);
};

/**
* Create a base64 sha1 HMAC for `options`.
*
* Specifically to be used with S3 presigned URLs
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox.client" id="apidoc.module.knox.client">module knox.client</a></h1>


    <h2>
        <a href="#apidoc.element.knox.client.client" id="apidoc.element.knox.client.client">
        function <span class="apidocSignatureSpan">knox.</span>client
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Client(options) {
  if (!options.key) throw new Error(&#x27;aws &#x22;key&#x22; required&#x27;);
  if (!options.secret) throw new Error(&#x27;aws &#x22;secret&#x22; required&#x27;);
  if (!options.bucket) throw new Error(&#x27;aws &#x22;bucket&#x22; required&#x27;);

  if (options.style &#x26;&#x26; options.style !== &#x27;virtualHosted&#x27; &#x26;&#x26;
      options.style !== &#x27;path&#x27;) {
    throw new Error(&#x27;style must be &#x22;virtualHosted&#x22; or &#x22;path&#x22;&#x27;);
  }

  if (options.port !== undefined &#x26;&#x26; isNaN(parseInt(options.port))) {
    throw new Error(&#x27;port must be a number.&#x27;);
  }

  var invalidness = isInvalid(options.bucket);
  var dnsUncompliance = isNotDnsCompliant(options.bucket);

  if (invalidness) {
    throw new Error(&#x27;Bucket name &#x22;&#x27; + options.bucket + &#x27;&#x22; &#x27; + invalidness + &#x27;.&#x27;);
  }

  // Save original options, we will need them for Client#copyTo
  this.options = utils.merge({}, options);

  // Make sure we don&#x27;t override options the user passes in.
  options = utils.merge({}, options);
  autoDetermineStyle(options);

  if (!options.endpoint) {
    if (!options.region || options.region === &#x27;us-standard&#x27; || options.region === &#x27;us-east-1&#x27;) {
      options.endpoint = &#x27;s3.amazonaws.com&#x27;;
      options.region = &#x27;us-standard&#x27;;
    } else {
      options.endpoint = &#x27;s3-&#x27; + options.region + &#x27;.amazonaws.com&#x27;;
    }

    if (options.region !== &#x27;us-standard&#x27;) {
      if (dnsUncompliance) {
        throw new Error(&#x27;Outside of the us-standard region, bucket names must&#x27; +
                        &#x27; be DNS-compliant. The name &#x22;&#x27; + options.bucket +
                        &#x27;&#x22; &#x27; + dnsUncompliance + &#x27;.&#x27;);
      }
    }
  } else {
    options.region = undefined;
  }

  var portSuffix = &#x27;undefined&#x27; == typeof options.port ? &#x22;&#x22; : &#x22;:&#x22; + options.port;
  this.secure = &#x27;undefined&#x27; == typeof options.port;

  if (options.style === &#x27;virtualHosted&#x27;) {
    this.host = options.bucket + &#x27;.&#x27; + options.endpoint;
    this.urlBase = options.bucket + &#x27;.&#x27; + options.endpoint + portSuffix;
  } else {
    this.host = options.endpoint;
    this.urlBase = options.endpoint + portSuffix + &#x27;/&#x27; + options.bucket;
  }

  // HTTP in Node.js &#x3c; 0.12 is horribly broken, and leads to lots of &#x22;socket
  // hang up&#x22; errors: https://github.com/LearnBoost/knox/issues/116. See
  // https://github.com/LearnBoost/knox/issues/116#issuecomment-15045187 and
  // https://github.com/substack/hyperquest#rant
  this.agent = false;

  utils.merge(this, options);

  this.url = this.secure ? this.https : this.http;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.createClient" id="apidoc.element.knox.client.createClient">
        function <span class="apidocSignatureSpan">knox.client.</span>createClient
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createClient = function (options){
  return new Client(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

## Examples

The following examples demonstrate some capabilities of knox and the S3 REST
API. First things first, create an S3 client:

```js
var client = knox.<span class="apidocCodeKeywordSpan">createClient</span>({
    key: &#x27;&#x3c;api-key-here&#x3e;&#x27;
  , secret: &#x27;&#x3c;secret-here&#x3e;&#x27;
  , bucket: &#x27;learnboost&#x27;
});
```

More options are documented below for features like other endpoints or regions.
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox.client.prototype" id="apidoc.module.knox.client.prototype">module knox.client.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.knox.client.prototype.copy" id="apidoc.element.knox.client.prototype.copy">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>copy
        <span class="apidocSignatureSpan">(sourceFilename, destFilename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">copy = function (sourceFilename, destFilename, headers){
  return this.put(destFilename, getCopyHeaders(this.bucket, sourceFilename, headers));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  * Trying to use bucket names that are not all lowercase will give an early error instead of failing with `SignatureDoesNotMatch
` upon attempting any operation. [See #44](https://github.com/LearnBoost/knox/issues/44#issuecomment-7074177) for more information
.
  * Fixed capturing of HTTP request errors to forward to the callback function for all &#x22;higher-level API&#x22; methods (i.e
. those accepting callbacks). (@shuzhang, #71)
  * Fixed README example to use `&#x22;image/jpeg&#x22;` instead of `&#x22;image/jpg&#x22;`. (@jedwood, #74)

0.0.10 / 2012-07-16
===================

  * Added `client.<span class="apidocCodeKeywordSpan">copy</span>(sourceFilename, destFilename, headers)` method for copying files
 within a bucket.
  * Added `client.deleteMultiple(filenames, headers, cb)` method for [multi-object delete](http://docs.amazonwebservices.com/AmazonS3
/latest/API/multiobjectdeleteapi.html).
  * Knox now passes through any Content-MD5 headers supplied to any of its methods, and automatically generates one for `putFile
`. (@staer, #36)
  * Fixed a bug with error propagation in `putStream`. (@xmilliard, #48)
  * Fixed requests to querystring resources. (@richtera, #70)
  * Updated tests to use [Mocha](http://visionmedia.github.com/mocha/) instead of Expresso; now they can be run on Windows.

0.0.9 / 2011-06-20
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.copyFile" id="apidoc.element.knox.client.prototype.copyFile">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyFile
        <span class="apidocSignatureSpan">(sourceFilename, destFilename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">copyFile = function (sourceFilename, destFilename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  var req = this.copy(sourceFilename, destFilename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
client.copy(&#x27;/test/source.txt&#x27;, &#x27;/test/dest.txt&#x27;).on(&#x27;response&#x27;, function(res){
  console.log(res.statusCode);
  console.log(res.headers);
}).end();

// or

client.<span class="apidocCodeKeywordSpan">copyFile</span>(&#x27;/source.txt&#x27;, &#x27;/dest.txt&#x27;, function(err, res){
  // ...
});
```

even between buckets:

```js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.copyFileTo" id="apidoc.element.knox.client.prototype.copyFileTo">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyFileTo
        <span class="apidocSignatureSpan">(sourceFilename, destBucket, destFilename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">copyFileTo = function (sourceFilename, destBucket, destFilename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  var req = this.copyTo(sourceFilename, destBucket, destFilename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.copyTo" id="apidoc.element.knox.client.prototype.copyTo">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>copyTo
        <span class="apidocSignatureSpan">(sourceFilename, destBucket, destFilename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">copyTo = function (sourceFilename, destBucket, destFilename, headers){
  var options = utils.merge({}, this.options);
  if (typeof destBucket == &#x27;string&#x27;) {
    options.bucket = destBucket;
  } else {
    utils.merge(options, destBucket);
  }
  var client = exports.createClient(options);
  return client.put(destFilename, getCopyHeaders(this.bucket, sourceFilename, headers));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // ...
});
```

even between buckets:

```js
client.<span class="apidocCodeKeywordSpan">copyTo</span>(&#x27;/source.txt&#x27;, &#x27;dest-bucket&#x27;, &#x27;/dest.txt&#x27;).
on(&#x27;response&#x27;, function(res){
  // ...
}).end();
```

and even between buckets in different regions:

```js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.del" id="apidoc.element.knox.client.prototype.del">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>del
        <span class="apidocSignatureSpan">(filename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">del = function (filename, headers){
  return this.request(&#x27;DELETE&#x27;, encodeSpecialCharacters(filename), headers);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

### DELETE

Delete our file:

```js
client.<span class="apidocCodeKeywordSpan">del</span>(&#x27;/test/Readme.md&#x27;).on(&#x27;response&#x27;, function(res){
  console.log(res.statusCode);
  console.log(res.headers);
}).end();
```

Likewise we also have `Client#deleteFile()` as a more concise (yet less
flexible) solution:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.deleteFile" id="apidoc.element.knox.client.prototype.deleteFile">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>deleteFile
        <span class="apidocSignatureSpan">(filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deleteFile = function (filename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }
  var req = this.del(filename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}).end();
```

Likewise we also have `Client#deleteFile()` as a more concise (yet less
flexible) solution:

```js
client.<span class="apidocCodeKeywordSpan">deleteFile</span>(&#x27;/test/Readme.md&#x27;, function(err, res){
  // check `err`, then do `res.pipe(..)` or `res.resume()` or whatever.
});
```

### HEAD

As you might expect we have `Client#head` and `Client#headFile`, following the
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.deleteMultiple" id="apidoc.element.knox.client.prototype.deleteMultiple">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>deleteMultiple
        <span class="apidocSignatureSpan">(filenames, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deleteMultiple = function (filenames, headers, fn){
  if (filenames.length &#x3e; BUCKET_OPS_MAX) {
    throw new Error(&#x27;Can only delete up to &#x27; + BUCKET_OPS_MAX + &#x27; files &#x27; +
      &#x27;at a time. You\&#x27;ll need to batch them.&#x27;);
  }

  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  var xml = makeDeleteXmlBuffer(filenames);

  headers[&#x27;Content-Length&#x27;] = xml.length;
  headers[&#x27;Content-MD5&#x27;] = crypto.createHash(&#x27;md5&#x27;).update(xml).digest(&#x27;base64&#x27;);

  var req = this.request(&#x27;POST&#x27;, &#x27;/?delete&#x27;, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end(xml);
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  * Fixed capturing of HTTP request errors to forward to the callback function for all &#x22;higher-level API&#x22; methods (i.e
. those accepting callbacks). (@shuzhang, #71)
  * Fixed README example to use `&#x22;image/jpeg&#x22;` instead of `&#x22;image/jpg&#x22;`. (@jedwood, #74)

0.0.10 / 2012-07-16
===================

  * Added `client.copy(sourceFilename, destFilename, headers)` method for copying files within a bucket.
  * Added `client.<span class="apidocCodeKeywordSpan">deleteMultiple</span>(filenames, headers, cb)` method for [multi-object delete
](http://docs.amazonwebservices.com/AmazonS3/latest/API/multiobjectdeleteapi.html).
  * Knox now passes through any Content-MD5 headers supplied to any of its methods, and automatically generates one for `putFile
`. (@staer, #36)
  * Fixed a bug with error propagation in `putStream`. (@xmilliard, #48)
  * Fixed requests to querystring resources. (@richtera, #70)
  * Updated tests to use [Mocha](http://visionmedia.github.com/mocha/) instead of Expresso; now they can be run on Windows.

0.0.9 / 2011-06-20
==================
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.get" id="apidoc.element.knox.client.prototype.get">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>get
        <span class="apidocSignatureSpan">(filename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (filename, headers){
  return this.request(&#x27;GET&#x27;, encodeSpecialCharacters(filename), headers);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

# knox

Node Amazon S3 Client.

## Features

  - Familiar API (`client.<span class="apidocCodeKeywordSpan">get</span>()`, `client.put()`, etc.)
  - Very Node-like low-level request capabilities via `http.Client`
  - Higher-level API with `client.putStream()`, `client.getFile()`, etc.
  - Copying and multi-file delete support
  - Streaming file upload and direct stream-piping support

## Examples
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.getFile" id="apidoc.element.knox.client.prototype.getFile">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>getFile
        <span class="apidocSignatureSpan">(filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFile = function (filename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  var req = this.get(filename, headers);
  registerReqListeners(req, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Node Amazon S3 Client.

## Features

  - Familiar API (`client.get()`, `client.put()`, etc.)
  - Very Node-like low-level request capabilities via `http.Client`
  - Higher-level API with `client.putStream()`, `client.<span class="apidocCodeKeywordSpan">getFile</span>()`, etc.
  - Copying and multi-file delete support
  - Streaming file upload and direct stream-piping support

## Examples

The following examples demonstrate some capabilities of knox and the S3 REST
API. First things first, create an S3 client:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.head" id="apidoc.element.knox.client.prototype.head">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>head
        <span class="apidocSignatureSpan">(filename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">head = function (filename, headers){
  return this.request(&#x27;HEAD&#x27;, encodeSpecialCharacters(filename), headers);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

Client.prototype.headFile = function(filename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }
  var req = this.<span class="apidocCodeKeywordSpan">head</span>(filename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end();
  return req;
};

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.headFile" id="apidoc.element.knox.client.prototype.headFile">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>headFile
        <span class="apidocSignatureSpan">(filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">headFile = function (filename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }
  var req = this.head(filename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.http" id="apidoc.element.knox.client.prototype.http">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>http
        <span class="apidocSignatureSpan">(filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">http = function (filename){
  filename = encodeSpecialCharacters(ensureLeadingSlash(filename));

  return &#x27;http://&#x27; + this.urlBase + filename;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // Everyone loves XML parsing.
}).end();
```

Finally, you can construct HTTP or HTTPS URLs for a file like so:

```js
var readmeUrl = client.<span class="apidocCodeKeywordSpan">http</span>(&#x27;/test/Readme.md&#x27;);
var userDataUrl = client.https(&#x27;/user.json&#x27;);
```

[copy]: http://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectCOPY.html
[multi-delete]: http://docs.aws.amazon.com/AmazonS3/latest/API/multiobjectdeleteapi.html
[list]: http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTBucketGET.html
[acl]: http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectGETacl.html
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.https" id="apidoc.element.knox.client.prototype.https">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>https
        <span class="apidocSignatureSpan">(filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">https = function (filename){
  filename = encodeSpecialCharacters(ensureLeadingSlash(filename));

  return &#x27;https://&#x27; + this.urlBase + filename;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}).end();
```

Finally, you can construct HTTP or HTTPS URLs for a file like so:

```js
var readmeUrl = client.http(&#x27;/test/Readme.md&#x27;);
var userDataUrl = client.<span class="apidocCodeKeywordSpan">https</span>(&#x27;/user.json&#x27;);
```

[copy]: http://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectCOPY.html
[multi-delete]: http://docs.aws.amazon.com/AmazonS3/latest/API/multiobjectdeleteapi.html
[list]: http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTBucketGET.html
[acl]: http://docs.amazonwebservices.com/AmazonS3/latest/API/RESTObjectGETacl.html
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.list" id="apidoc.element.knox.client.prototype.list">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>list
        <span class="apidocSignatureSpan">(params, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">list = function (params, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  if (&#x27;function&#x27; == typeof params) {
    fn = params;
    params = null;
  }

  if (params &#x26;&#x26; !LIST_PARAMS[Object.keys(params)[0]]) {
    headers = params;
    params = null;
  }

  var url = params ? &#x27;?&#x27; + qs.stringify(params) : &#x27;&#x27;;
  var req = this.request(&#x27;GET&#x27;, url, headers);
  registerReqListeners(req, function(err, res){
    if (err) return fn(err);

    var xmlStr = &#x27;&#x27;;

    res.on(&#x27;data&#x27;, function(chunk){
      xmlStr += chunk;
    });

    res.on(&#x27;end&#x27;, function(){
      new xml2js.Parser({explicitArray: false, explicitRoot: false})
        .parseString(xmlStr, function(err, data){
          if (err) return fn(err);
          if (data == null) return fn(new Error(&#x27;null response received&#x27;));

          delete data.$;
          normalizeResponse(data);

          if (!(&#x27;Contents&#x27; in data)) {
            data.Contents = [];
          }

          fn(null, data);
        });
    });
  });
  req.on(&#x27;error&#x27;, fn);
  req.end();
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// ...
});
```

or [listing all the files in your bucket][list]:

```js
client.<span class="apidocCodeKeywordSpan">list</span>({ prefix: &#x27;my-prefix&#x27; }, function(err, data){
/* `data` will look roughly like:

{
  Prefix: &#x27;my-prefix&#x27;,
  IsTruncated: true,
  MaxKeys: 1000,
  Contents: [
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.put" id="apidoc.element.knox.client.prototype.put">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>put
        <span class="apidocSignatureSpan">(filename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">put = function (filename, headers){
  headers = utils.merge({}, headers || {});
  return this.request(&#x27;PUT&#x27;, encodeSpecialCharacters(filename), headers);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

# knox

Node Amazon S3 Client.

## Features

  - Familiar API (`client.get()`, `client.<span class="apidocCodeKeywordSpan">put</span>()`, etc.)
  - Very Node-like low-level request capabilities via `http.Client`
  - Higher-level API with `client.putStream()`, `client.getFile()`, etc.
  - Copying and multi-file delete support
  - Streaming file upload and direct stream-piping support

## Examples
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.putBuffer" id="apidoc.element.knox.client.prototype.putBuffer">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>putBuffer
        <span class="apidocSignatureSpan">(buffer, filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">putBuffer = function (buffer, filename, headers, fn){
  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  headers[&#x27;Content-Length&#x27;] = buffer.length;

  var req = this.put(filename, headers);
  fn = once(fn);
  registerReqListeners(req, fn);
  req.end(buffer);
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
use `Client#putBuffer()`:

```js
var buffer = new Buffer(&#x27;a string of data&#x27;);
var headers = {
  &#x27;Content-Type&#x27;: &#x27;text/plain&#x27;
};
client.<span class="apidocCodeKeywordSpan">putBuffer</span>(buffer, &#x27;/string.txt&#x27;, headers, function(err, res){
  // ...
});
```

Note that both `putFile` and `putStream` will stream to S3 instead of reading
into memory, which is great. And they return objects that emit `&#x27;progress&#x27;`
events too, so you can monitor how the streaming goes! The progress events have
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.putFile" id="apidoc.element.knox.client.prototype.putFile">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>putFile
        <span class="apidocSignatureSpan">(src, filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">putFile = function (src, filename, headers, fn){
  var self = this;
  var emitter = new Emitter;

  if (&#x27;function&#x27; == typeof headers) {
    fn = headers;
    headers = {};
  }

  debug(&#x27;put %s&#x27;, src);
  fs.stat(src, function (err, stat) {
    if (err) return fn(err);

    var contentType = mime.lookup(src);

    // Add charset if it&#x27;s known.
    var charset = mime.charsets.lookup(contentType);
    if (charset) {
      contentType += &#x27;; charset=&#x27; + charset;
    }

    headers = utils.merge({
        &#x27;Content-Length&#x27;: stat.size
      , &#x27;Content-Type&#x27;: contentType
    }, headers);

    var stream = fs.createReadStream(src);

    var req = self.putStream(stream, filename, headers, fn);

    req.on(&#x27;progress&#x27;, emitter.emit.bind(emitter, &#x27;progress&#x27;));
  });

  return emitter;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Each HTTP verb has an alternate method with the &#x22;File&#x22; suffix, for example
`put()` also has a higher level method named `putFile()`, accepting a source
filename and performing the dirty work shown above for you. Here is an example
usage:

```js
client.<span class="apidocCodeKeywordSpan">putFile</span>(&#x27;my.json&#x27;, &#x27;/user.json&#x27;, function(err, res){
  // Always either do something with `res` or at least call `res.resume()`.
});
```

Another alternative is to stream via `Client#putStream()`, for example:

```js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.putStream" id="apidoc.element.knox.client.prototype.putStream">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>putStream
        <span class="apidocSignatureSpan">(stream, filename, headers, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">putStream = function (stream, filename, headers, fn){
  var contentLength = getHeader(headers, &#x27;content-length&#x27;);
  if (contentLength === null) {
    process.nextTick(function () {
      fn(new Error(&#x27;You must specify a Content-Length header.&#x27;));
    });
    return;
  }

  var self = this;
  var req = self.put(filename, headers);

  fn = once(fn);
  registerReqListeners(req, fn);
  stream.on(&#x27;error&#x27;, fn);

  var counter = new StreamCounter();
  counter.on(&#x27;progress&#x27;, function(){
    req.emit(&#x27;progress&#x27;, {
        percent: counter.bytes / contentLength * 100 | 0
      , written: counter.bytes
      , total: contentLength
    });
  });

  stream.pipe(counter);
  stream.pipe(req);
  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Node Amazon S3 Client.

## Features

  - Familiar API (`client.get()`, `client.put()`, etc.)
  - Very Node-like low-level request capabilities via `http.Client`
  - Higher-level API with `client.<span class="apidocCodeKeywordSpan">putStream</span>()`, `client.getFile()`, etc.
  - Copying and multi-file delete support
  - Streaming file upload and direct stream-piping support

## Examples

The following examples demonstrate some capabilities of knox and the S3 REST
API. First things first, create an S3 client:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.request" id="apidoc.element.knox.client.prototype.request">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>request
        <span class="apidocSignatureSpan">(method, filename, headers)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">request = function (method, filename, headers){
  var options = { hostname: this.host, agent: this.agent, port: this.port }
    , date = new Date
    , headers = headers || {}
    , fixedFilename = ensureLeadingSlash(filename);

  // Default headers
  headers.Date = date.toUTCString()
  if (this.style === &#x27;virtualHosted&#x27;) {
    headers.Host = this.host;
  }

  if (&#x27;undefined&#x27; != typeof this.token)
    headers[&#x27;x-amz-security-token&#x27;] = this.token;

  // Authorization header
  headers.Authorization = auth.authorization({
      key: this.key
    , secret: this.secret
    , verb: method
    , date: date
    , resource: auth.canonicalizeResource(&#x27;/&#x27; + this.bucket + fixedFilename)
    , contentType: getHeader(headers, &#x27;content-type&#x27;)
    , md5: getHeader(headers, &#x27;content-md5&#x27;) || &#x27;&#x27;
    , amazonHeaders: auth.canonicalizeHeaders(headers)
  });

  var pathPrefix = this.style === &#x27;path&#x27; ? &#x27;/&#x27; + this.bucket : &#x27;&#x27;;

  // Issue request
  options.method = method;
  options.path = pathPrefix + fixedFilename;
  options.headers = headers;
  var req = (this.secure ? https : http).request(options);
  req.url = this.url(filename);
  debug(&#x27;%s %s&#x27;, method, req.url);

  return req;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
```

And you can always issue ad-hoc requests, e.g. the following to
[get an object&#x27;s ACL][acl]:

```js
client.<span class="apidocCodeKeywordSpan">request</span>(&#x27;GET&#x27;, &#x27;/test/Readme.md?acl&#x27;).on(&#x27;response&#x27
;, function(res){
  // Read and parse the XML response.
  // Everyone loves XML parsing.
}).end();
```

Finally, you can construct HTTP or HTTPS URLs for a file like so:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.client.prototype.signedUrl" id="apidoc.element.knox.client.prototype.signedUrl">
        function <span class="apidocSignatureSpan">knox.client.prototype.</span>signedUrl
        <span class="apidocSignatureSpan">(filename, expiration, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">signedUrl = function (filename, expiration, options){
  var epoch = Math.floor(expiration.getTime()/1000)
    , pathname = url.parse(filename).pathname
    , resource = &#x27;/&#x27; + this.bucket + ensureLeadingSlash(pathname);

  if (options &#x26;&#x26; options.qs) {
    resource += &#x27;?&#x27; + decodeURIComponent(qs.stringify(options.qs));
  }

  var signature = auth.signQuery({
      secret: this.secret
    , date: epoch
    , resource: resource
    , verb: (options &#x26;&#x26; options.verb) || &#x27;GET&#x27;
    , contentType: options &#x26;&#x26; options.contentType
    , extraHeaders : options &#x26;&#x26; options.extraHeaders
    , token: this.token
  });

  var queryString = qs.stringify(utils.merge({
    Expires: epoch,
    AWSAccessKeyId: this.key,
    Signature: signature
  }, (options &#x26;&#x26; options.qs) || {}));

  if (typeof this.token !== &#x27;undefined&#x27;)
      queryString += &#x27;&#x26;x-amz-security-token=&#x27; + encodeURIComponent(this.token);

  return this.url(filename) + &#x27;?&#x27; + queryString;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox.utils" id="apidoc.module.knox.utils">module knox.utils</a></h1>


    <h2>
        <a href="#apidoc.element.knox.utils.merge" id="apidoc.element.knox.utils.merge">
        function <span class="apidocSignatureSpan">knox.utils.</span>merge
        <span class="apidocSignatureSpan">(a, b)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">merge = function (a, b){
  var keys = Object.keys(b);
  for (var i = 0, len = keys.length; i &#x3c; len; ++i) {
    var key = keys[i];
    a[key] = b[key]
  }
  return a;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param {String} sourceFilename
 * @param {Object} headers
 * @api private
 */

function getCopyHeaders(sourceBucket, sourceFilename, headers) {
  sourceFilename = encodeSpecialCharacters(ensureLeadingSlash(sourceFilename));
  headers = utils.<span class="apidocCodeKeywordSpan">merge</span>({}, headers || {});
  headers[&#x27;x-amz-copy-source&#x27;] = &#x27;/&#x27; + sourceBucket + sourceFilename;
  headers[&#x27;Content-Length&#x27;] = 0; // to avoid Node&#x27;s automatic chunking if omitted
  return headers;
}


/**
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.knox.utils.base64" id="apidoc.module.knox.utils.base64">module knox.utils.base64</a></h1>


    <h2>
        <a href="#apidoc.element.knox.utils.base64.decode" id="apidoc.element.knox.utils.base64.decode">
        function <span class="apidocSignatureSpan">knox.utils.base64.</span>decode
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">decode = function (str){
  return new Buffer(str, &#x27;base64&#x27;).toString();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.knox.utils.base64.encode" id="apidoc.element.knox.utils.base64.encode">
        function <span class="apidocSignatureSpan">knox.utils.base64.</span>encode
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">encode = function (str){
  return new Buffer(str).toString(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
